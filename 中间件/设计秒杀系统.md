## 如何设计一个秒杀系统

https://www.jianshu.com/p/729f1f0f6e18

    1.业务特性
        1.倒计时开场，到点开通购买

        2.价格便宜，库存少

        3.一般业务用户限制，一个用户只能购买一个商品
    
    2.业务特性
        1、查询商品详情
            1.如何处理大量的商品详情请求
                秒杀前因为用户不断刷新商品详情页，我们可以将该页面上的元素尽量静态化处理，
                除了秒杀按钮需要服务端进行动态判断，其他的静态数据可以缓存在浏览器和 CDN 上。
            2.开场倒计时 这个倒计时的效果由客户端实现，不过时间一定是同步的服务器端，
            客户端可以每隔几分钟同步一次，再重新倒计时。

        2、点击购买，校验库存
            1.放入缓存
            最好的方式就是通过后台管理系统，因为我们新建一个秒杀商品，肯定是通过后台管理系统操作的，
            添加秒杀商品后，应该会有一个类似按钮【上线发布】，可以在这个按钮事件进行缓存，

        3、扣库存，创建订单
            1.减库存也放入缓存
            2.访问数据库 加锁
            3.何时扣库存
                1、方案一：下单减库存，即当买家下单后，商品库存减去买家购买的数量
                    引发恶意下单
                2、方案二：付款时库存，即当买家下单后，并不立即减库存，而是等用户付款后才减库存
                    设置超时支付时间
        4、去支付   
    
    3.分布式限流
        100万个请求 只允许5000个用户（业务评估出来的数值）进入业务系统，其他请求的直接返回失败就行了。
    
    4.消息异步 
        1.这个时候我们需要做一些异步处理，让5000个下单请求进入消息队列，
        让订单消费服务去慢慢处理5000个请求，这样就有效的把并发同步请求，改为了串行异步。
        2.前端在下单的时候，就没法立刻得到下单的结果，所以前端要做一个【抢购中。。。】的状态页面，
        在此页面中定时轮询下单结果。这样就大大提升了系统的吞吐量，降低了系统压力。
